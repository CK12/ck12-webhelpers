!function(){"use strict";tinymce.create("tinymce.plugins.CK12PastePlugin",{init:function(a){function h(a){var b,c,d=[],g=a.attributes;if(g.length){for(b=0;b<g.length;b++)c=g[b].name,"type"!==c&&"input"===a.nodeName.toLowerCase()&&$(a).attr(c,(g[b].value||"").trim()),0===c.indexOf("data-")&&-1===e.indexOf(c)&&-1===c.indexOf("data-ck12embed-")&&d.push(g[b].name),c&&!g[b].value&&d.push(g[b].name),-1!==f.indexOf(c)&&d.push(g[b].name);$(a).removeAttr(d.join(" "))}}function i(){if($(this).hasClass("x-ck12-mathEditor")||$(this).parents(".x-ck12-mathEditor").length)return this;if(-1!==g.indexOf((this.tagName||"").toLowerCase()))return $(this).remove(),!1;var a,b=this.classList;for((0!==this.id.indexOf("x-ck12-")||8>this.id.length)&&-1===c.indexOf(this.id)&&(this.id=""),a=0;a<b.length;a++)(0!==b.item(a).indexOf("x-ck12-")||8>b.item(a).length)&&-1===d.indexOf(b.item(a))&&(b.remove(b.item(a)),a--);return h(this),this}var b=this,c=["__mce_tmp","ck12image","__mce_tmp_caption","previewImg","mcepastebin"],d=["ck12-media-placeholder","mceItemTable"],e=["data-error","data-mce-src"],f=["mce_bogus"],g=["nobr"];a.addCommand("mcePreProcess",function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,K,D=d.content,E=[],F="",G=0,H=!0,I="",J=[];if(J=D.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)(.+)$/i),J&&("www."==J[1]&&(J[1]="http://www."),K=J[1]+J[2].split(" ")[0],D='<a href="'+K+'">'+K+"</a>"),/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(D)?$(D).each(function(){if(g=$(this).html(),"null"!==g){for(h=$(this).attr("style").toString(),i=g.lastIndexOf("__MCE_ITEM__")+"__MCE_ITEM__".length,j=-1;;){if("&nbsp;"!==g.substring(i).substring(0,6))break;g=g.replace("&nbsp;","")}if(k=g.indexOf("&nbsp;"),l=g.indexOf(".",i),m=g.indexOf(")",i),l===-1&&m===-1||(l!==-1&&(m===-1||l<m)?j=l:m!==-1&&(l===-1||m<l)&&(j=m),j>k&&(j=-1)),h&&void 0!==h&&h.indexOf("mso-list")!==-1)try{if(H&&(F+="@@ListStructure@@",H=!1),n=h.substring(h.indexOf("mso-list")).split(" "),o="",o=n[1].indexOf("level")!==-1?n[1].substring(5):n[2].substring(5),p=parseInt(o,10),q="",G<p)j!==-1?(I+="<ol>",E.push("</ol>")):(I+="<ul>",E.push("</ul>"));else if(G>p)for(f=G;f>p&&E.length>0;f--)e=E.pop(),I+=e;G=p,q=j!==-1?g.substring(j+1).replace(/(&nbsp;)*/gi,""):g.replace(/(__MCE_ITEM__)*/gi,"").substring(1).replace(/(&nbsp;)*/gi,""),I+="<li>"+q+"</li>"}catch(a){console.log(a)}else{for(f=G;f>0&&E.length>0;f--)I+=E.pop();F+=$("<div>").append(this).html(),F=F.replace("@@ListStructure@@",I),H=!0,I="",G=0}}}):F+=D,F.indexOf("@@ListStructure@@")!==-1&&(F=F.replace("@@ListStructure@@",I),H=!0,I="",G=0),D=F,D=D.replace(/<\s*script.*?>/g,"").replace(/<\/script.*?>/g,""),D=D.replace(/<\s*meta.*?>/g,""),D=D.replace(/<wbr>/g,""),D=D.replace(/<h5>/g,"<h5>").replace(/<\/h5>/g,"</h5>").replace(/<h5\s*class="\s*((\w|\s|_*|-*)*)\s*"\s*>/gi,"<h5>"),D=D.replace(/<h6>/g,"<h5>").replace(/<\/h6>/g,"</h5>").replace(/<h6\s*class="\s*((\w|\s|_*|-*)*)\s*"\s*>/gi,"<h5>"),D=D.replace(/<h4>/g,"<h4>").replace(/<\/h4>/g,"</h4>").replace(/<h4\s*class="\s*((\w|\s|_*|-*)*)\s*"\s*>/gi,"<h4>"),D=D.replace(/<h3>/g,"<h3>").replace(/<\/h3>/g,"</h3>").replace(/<h3\s*class="\s*((\w|\s|_*|-*)*)\s*"\s*>/gi,"<h3>"),D=D.replace(/<h2>/g,"<h3>").replace(/<\/h2>/g,"</h3>").replace(/<h2\s*class="\s*((\w|\s|_*|-*)*)\s*"\s*>/gi,"<h3>"),D=D.replace(/<h1>/g,"<h3>").replace(/<\/h1>/g,"</h3>").replace(/<h1\s*class="\s*((\w|\s|_*|-*)*)\s*"\s*>/gi,"<h3>"),D=D.replace(/<u>/gi,'<span class="x-ck12-underline">').replace(/<\/u>/gi,"</span>"),D=D.replace(/<s>/gi,'<span class="x-ck12-strikethrough">').replace(/<\/s>/gi,"</span>"),D=D.replace(/<\s*span\s*class="x-ck12-img-inline">\s*<img/gim,'<span class="x-ck12-img-inline"><img class="x-ck12-img-inline" '),D=D.replace(/<\/?\s*br\s*(class="Apple-interchange-newline")?\/?>/g,"\n"),D=D.replace(/<br\s*style="mso-special-character:line-break;\s*page-break-before:always"\s*clear="all"\s*>/gi,'<hr class="x-ck12-pagebreak" />'),D=D.replace(/<p\s.*style="margin-left:\.in.*\/>/gi,'<p class="x-ck12-indent">'),F=$("<div>"+D+"</div>"),F.find("img.x-ck12-block-math").each(function(){var a=$(this);void 0!==a.attr("alt")&&a.attr("alt",a.attr("alt").replace("<","\\lt ").replace(">","\\gt ")),void 0!==a.attr("data-flx-url")&&a.attr("src",a.attr("data-flx-url"))}),D=F.html(),r=new RegExp(/<img+\s+((?!x-ck12-math)(?!x-ck12-img-inline)(?!ck12-media-placeholder)(?!x-ck12-block-math)(?!x-ck12-hwpmath)(?!\/perma\/resource)(?!>).)+?>/gi),s=D.match(r),t=!1,null!==s){var L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z;for(f=0;f<s.length;f++)if(L=s[f],M=new RegExp('alt="(.*?)"'),N=new RegExp('data-flx-url="(.*?)"'),O=new RegExp(/src\s*=\s*"(.+?)"/g),P=new RegExp('title="(.*?)"'),R=L.match(O),S=L.match(M),T=L.match(P),Q=L.match(N),U="",V="",W="",X="",null!==S&&(S.length>0&&(U=S[1]),V=S[1]),null!==T&&T.length>0&&(W=T[1]),null!==Q&&Q.length>0&&(X=Q[1]),Y="",null!==R){if(R.toString().indexOf("file:/")!==-1){Z=R.toString().match('src="(.*?)"'),null!==Z&&Z.length>0&&tinyMCE.activeEditor.execCommand("mceAdvImage"),t=!0;break}-1!==R.toString().indexOf("data:image")?($(document).trigger($.flxweb.editor.tinymce.events.DATA_IMAGE,$(D)[0]),D=$(D).addClass("x-ck12-dataimage-"+window.imageClassIterator)[0].outerHTML):(Y=0===X.indexOf("/flx/show")||0===X.indexOf("/flx/math")||0===X.indexOf("/flx/render")||0===X.indexOf("/media")?'<div class="x-ck12-img-postcard x-ck12-nofloat" ><p><img src ="'+X+'"':'<div class="x-ck12-img-postcard x-ck12-nofloat" ><p><img '+R,Y+=' data-flx-url = "'+X+'" longdesc="'+V+'" title="'+W+'" alt="'+U+'"/></p></div>',t||(D=D.replace(L,Y)))}}if(u=new RegExp(/<ol+\s+(?!x-ck12-\w+)(?!>)(?=type\s*=\s*\"?(\w+)\"?).+?>/gi),v=D.match(u),w="",null!==v){var _,aa,ba,ca=new RegExp(/\d+/),da=new RegExp(/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/),ea=new RegExp(/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/i),fa=new RegExp(/[a-z]+/),ga=new RegExp(/[A-Z]+/);for(f=0;f<v.length;f++)x=v[f],aa="",_=new RegExp(/type\s*=\s*\"?(\w+)\"?/),ba=x.match(_),null!==ba&&ba.length>1&&(ca.test(ba[1])?aa="x-ck12-decimal":da.test(ba[1])?aa="x-ck12-upper-roman":ea.test(ba[1])?aa="x-ck12-lower-roman":fa.test(ba[1])?aa="x-ck12-lower-alpha":ga.test(ba[1])&&(aa="x-ck12-upper-alpha")),w='<ol class="'+aa+'" >',D=D.replace(x,w)}if(y=new RegExp(/<a[^<]*(href="([^"]+)">)/g),z=D.match(y),B="",null!==z){var ha,ia=new RegExp('href="(.*?)"');for(f=0;f<z.length;f++)A=z[f],ha=A.match(ia),null!==ha&&ha.length>1&&(B='<a href="'+ha[1]+'" >',D=D.replace(A,B))}if(C=b._pasteInsideElementBox(tinyMCE.activeEditor)){var ja,ka=new RegExp(/<div.*?class=\"(x-ck12-element-box-body|x-ck12-element-box-header|x-ck12-element-box)\".*?>/g);if(ja=D.match(ka),null!==ja)for(f=0;f<ja.length;f++)D=D.replace(ja[f],"<p>");D=D.replace(/class=["']+(?!x-ck12).*["']+"/gim,"").replace(/data-artifactrevisionid="\s*((\w|\s|_*|-*)*)\s*"/gim,""),D=D.replace(/data-artifacttype="\s*((\w|\s|_*|-*)*)\s*"/gim,"").replace(/data-artifactid="\s*((\w|\s|_*|-*)*)\s*"/gim,"")}D=b._pasteInsideTable(tinyMCE.activeEditor,D),D.indexOf("MathJax-Span")!==-1&&(D=D.indexOf("x-ck12-mathEditor")!==-1?0==D.indexOf("<span")?b._pasteEquation(tinyMCE.activeEditor,"&nbsp;"+D+"&nbsp;"):b._pasteEquation(tinyMCE.activeEditor,D):""),D=$("<div>"+D+"</div>").children().each(function(){return!$(this).closest(".x-ck12-mathEditor").length&&void(a.dom.isBlock(this)&&$(this).addClass("x-ck12-dirty").removeClass("x-ck12-validated"))}).end().html();var la=D.indexOf("youtube.com/watch?v="),ma=la!=-1?la:D.indexOf("youtu.be/");if(ma!==-1){var na=la!=-1?$.trim(D.substring(ma+20,ma+31)):$.trim(D.substring(ma+9,ma+20));11===na.length&&(D=b._youtubeEmbed(tinyMCE.activeEditor,D,na))}tinymce.isIE&&(D="<span></span>"+D+"<span></span>"),d.content=D}),a.addCommand("mcePostProcess",function(a,b){$(b.node).find("*").each(function(){i.call(this);var a,b,c,d,e,f,g=$(this);if(a=g.attr("class"),a&&a.indexOf("x-ck12-")===-1){for(b=a.split(" "),c="",d=0;d<b.length;d++)b[d].indexOf("x-ck12-")===-1&&b[d].indexOf("ck12-")===-1||(c+=b[d]+" ");g.attr("class",c)}if(e=g.attr("id"),e&&e.indexOf("x-ck12-")===-1)if(!g.hasClass("x-ck12-mathEditor")&&e.match("MathJax"))g.removeAttr("id");else if(null!==tinymce.activeEditor.dom.get(e)){for(f=tinymce.DOM.uniqueId();null!==tinymce.activeEditor.dom.get(f);)f=tinymce.DOM.uniqueId();g.attr("id",f)}g.removeAttr("data-loadurl")}),$(b.node).find("h1,h2,h3,h4,h5,h6").find("*").remove()})},_pasteInsideElementBox:function(a){var b,c,d=a.getParam("element_box_class"),e=a.getParam("element_box_header_class"),f=a.getParam("element_box_body_class");return b=a.dom.getParent(a.selection.getStart(),function(b){return a.dom.hasClass(b,d)||a.dom.hasClass(b,e)||a.dom.hasClass(b,f)}),c=a.dom.getParent(a.selection.getEnd(),function(b){return a.dom.hasClass(b,d)||a.dom.hasClass(b,e)||a.dom.hasClass(b,f)}),!(!b||!c)},_pasteInsideTable:function(a,b){var c,d,e,f,g,h,i=new RegExp(/<table.*?>.*<\/table.*?>/gim),j=new RegExp(/<iframe.*?>.*<\/iframe.*?>/gim),k=new RegExp(/\n/gim);if(h=b.replace(k,""),c=b.replace(/\n/gim,"").match(i),d=b.replace(/\n/gim,"").match(j),(null!==c||null!==d)&&a&&a.parents&&a.parents.length>0)for(f=!1,e=0;e<a.parents.length&&!f;e++)g=a.parents[e],"TD"===g.tagName.toUpperCase()&&(f=!0,null!==d&&(b=h.replace(j,"")),null!==c&&(b=h.replace(i,"")));return b},_pasteEquation:function(a,b){var c,d,e,f,h,i=$("<div>"+b+"</div>");return $.each(i.find(".x-ck12-mathEditor"),function(){for(d=$(this),d.find("br.Apple-interchange-newline").remove(),e=d.attr("id"),f=tinymce.DOM.uniqueId();null!==a.dom.get(f);)f=tinymce.DOM.uniqueId();h=d.html().split(e).join(f),d.html(h).attr("id",f).removeClass("selectedElement showContextMenu forSingleClick doubleClick")}),c=($(i).html()||"").trim()},_youtubeEmbed:function(a,b,c){function e(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))}var d='<iframe width="560" height="315" src="https://www.youtube.com/embed/'+c+'" frameborder="0" allowfullscreen></iframe>';return $.ajax({url:"/ajax/create/embeddedobject/",data:{embed_code:e(d)},success:function(a){if(a)if("error"!==a.status){for(var b=top.tinymce.activeEditor,c=b.plugins.ck12embed.htmlstrToImg(a.iframe),d={},e=b.dom.getAttrib(b.selection.getNode(),"data-ck12embed-iframe-id"),f=0;f<c.attributes.length;f++){var g=c.attributes[f];d[g.name]=g.value}e&&""!==e&&e.indexOf("x-ck12-")!==-1||(e=""+ +new Date,e="x-ck12-"+window.btoa(e)),d["data-ck12embed-iframe-id"]=e;var h=b.dom.create("img",d);$(b.selection.getNode()).append(h),b.execCommand("mceAutoResize")}else{var i=$.Event("OBJECT_FETCH_ERROR");$.extend(i,{error_info:{data:a}}),$(document).trigger(i)}},dataType:"json"}),b}}),tinymce.PluginManager.add("ck12paste",tinymce.plugins.CK12PastePlugin)}();