(function(){tinymce.create("tinymce.plugins.PageBreakPlugin",{init:function(b,d){var f='<hr class="x-ck12-pagebreak" />',a="x-ck12-pagebreak",c=b.getParam("pagebreak_separator","<!-- pagebreak -->"),e;e=new RegExp(c.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,function(g){return"\\"+g}),"g");b.addCommand("x-ck12-pagebreak",function(){b.execCommand("mceInsertContent",0,f)});b.addButton("pagebreak",{title:"pagebreak.desc",cmd:a});b.onInit.add(function(){if(b.theme.onResolveName){b.theme.onResolveName.add(function(g,h){if(h.node.nodeName=="HR"&&b.dom.hasClass(h.node,a)){h.name="pagebreak"}})}});b.onClick.add(function(g,h){h=h.target;if(h.nodeName==="HR"&&g.dom.hasClass(h,a)){g.selection.select(h)}});b.onNodeChange.add(function(j,h,l){if(j&&j.parents&&j.parents.length>0){for(var k=0;k<j.parents.length;k++){var g=j.parents[k];if("BR"==g.tagName.toUpperCase()||"P"==g.tagName.toUpperCase()){h.setDisabled("pagebreak",false)}else{h.setDisabled("pagebreak",true)}}}if(l.nodeName==="HR"&&j.dom.hasClass(l,a)){h.setActive("pagebreak",true);h.setDisabled("pagebreak",false)}else{h.setActive("pagebreak",false)}});b.onBeforeSetContent.add(function(g,h){h.content=h.content.replace(e,f)});b.onPostProcess.add(function(g,h){if(h.get){h.content=h.content.replace(/<img[^>]+>/g,function(i){if(i.indexOf('class="x-ck12-pagebreak')!==-1){i=c}return i})}})},getInfo:function(){return{longname:"PageBreak",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/pagebreak",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("pagebreak",tinymce.plugins.PageBreakPlugin)})();