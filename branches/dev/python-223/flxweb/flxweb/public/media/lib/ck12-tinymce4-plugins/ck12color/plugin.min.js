tinymce.PluginManager.add("ck12color",function(a){"use strict";function e(a){return b.colorsObj[a]?b.colorsObj[a]:null}function f(b){var c;return a.dom.getParents(a.selection.getStart(),function(a){var d;(d=a.style["forecolor"===b?"color":"background-color"])&&(c=d)}),c}function g(){var b,c,f,d=[],e={};for(f=a.settings.textcolor_map||["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"],c=0;c<f.length;c+=2)d.push({text:f[c+1],color:"#"+f[c]});for(c=0;c<f.length;c+=2)e["#"+f[c]]=f[c+1];return b={colorsArray:d,colorsObj:e}}function h(){function o(a,b){var c="transparent"==a;return'<td class="mce-grid-cell'+(c?" mce-colorbtn-trans":"")+'"><div id="'+m+"-"+n++ +'" data-mce-color="'+(a?a:"")+'" role="option" tabIndex="-1" style="'+(a?"background-color: "+a:"")+'" title="'+tinymce.translate(b)+'">'+(c?"&#215;":"")+"</div></td>"}var f,g,h,i,j,k,l,e=this,m=e._id,n=0;for(f=b.colorsArray,"transparent"!==f[f.length-1].color&&f.push({text:tinymce.translate("No color"),color:"transparent"}),h='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>',i=f.length-1,k=0;k<d;k++){for(h+="<tr>",j=0;j<c;j++)l=k*c+j,l>i?h+="<td></td>":(g=f[l],h+=o(g.color,g.text));h+="</tr>"}if(a.settings.color_picker_callback){for(h+='<tr><td colspan="'+c+'" class="mce-custom-color-btn"><div id="'+m+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="'+m+'-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button></div></td></tr>",h+="<tr>",j=0;j<c;j++)h+=o("","Custom color");h+="</tr>"}return h+="</tbody></table>"}function i(a){return/(x-ck12-textcolor|x-ck12-textbgcolor)/g.test(a.className)}function j(b,c){var d=e(c);d&&a.undoManager.transact(function(){a.focus(),a.formatter.apply(b,{value:d}),a.nodeChanged()}),a.execCommand("mceCK12CleanupRosettaColors",!1)}function k(b){var e,c=a.selection.getNode(),d=null;i(c)||(d=Array.prototype.filter.call(c.children,i),d=d.length?d[0]:null,d&&(c=d)),"ck12textcolor"===b?e=c.className.trim().split("x-ck12-textcolor-")[1]:"ck12highlight"===b&&(e=c.className.trim().split("x-ck12-textbgcolor-")[1],e||"STRONG"!=c.nodeName&&"EM"!=c.nodeName||(e=c.parentNode.className.trim().split("x-ck12-textbgcolor-")[1])),a.undoManager.transact(function(){a.focus(),a.formatter.remove(b,{value:e},d,!0),a.nodeChanged()})}function l(b){function g(a){d.hidePanel(),d.color(a),j(d.settings.format,a)}function h(){d.hidePanel(),d.resetColor(),k(d.settings.format)}function i(a,b){a.style.background=b,a.setAttribute("data-mce-color",b)}var e,d=this.parent();tinymce.DOM.getParent(b.target,".mce-custom-color-btn")&&(d.hidePanel(),a.settings.color_picker_callback.call(a,function(a){var e,f,h,b=d.panel.getEl().getElementsByTagName("table")[0];for(e=tinymce.map(b.rows[b.rows.length-1].childNodes,function(a){return a.firstChild}),h=0;h<e.length&&(f=e[h],f.getAttribute("data-mce-color"));h++);if(h===c)for(h=0;h<c-1;h++)i(e[h],e[h+1].getAttribute("data-mce-color"));i(f,a),g(a)},f(d.settings.format))),e=b.target.getAttribute("data-mce-color"),e?(this.lastId&&document.getElementById(this.lastId).setAttribute("aria-selected",!1),b.target.setAttribute("aria-selected",!0),this.lastId=b.target.id,"transparent"===e?h():g(e)):null!==e&&d.hidePanel()}function m(){var a=this;a._color?j(a.settings.format,a._color):k(a.settings.format)}var b,c,d;b=g(),d=a.settings.textcolor_rows||5,c=a.settings.textcolor_cols||8,a.on("init",function(){a.formatter.register("ck12textcolor",{inline:"span",classes:"x-ck12-textcolor-%value"}),a.formatter.register("ck12highlight",{inline:"span",classes:"x-ck12-textbgcolor-%value"})}),a.addCommand("mceCK12CleanupRosettaColors",function(){var b=a.dom,c=b.select("span");if(c&&c.length)for(var d,e,f,g,h,i,j=0;j<c.length;j++)if(d=c[j],h="",d.className&&(d.className.indexOf("x-ck12-textcolor")!==-1||d.className.indexOf("x-ck12-textbgcolor")!==-1)){e=d.className.split(" "),i=[];for(var k=0;k<e.length;k++)f=e[k],0===f.indexOf("x-ck12-textcolor")?g=f:0===f.indexOf("x-ck12-textbgcolor")?h=f:f&&i.push(f);i.push(g),i.push(h),i=i.join(" "),d.className=i}}),a.addButton("ck12textcolor",{type:"colorbutton",icon:"forecolor",tooltip:"Text color",format:"ck12textcolor",class:"mce_forecolor",panel:{role:"application",ariaRemember:!0,html:h,onclick:l},onclick:m}),a.addButton("ck12highlight",{type:"colorbutton",icon:"backcolor",tooltip:"Highlight color",format:"ck12highlight",class:"mce_backcolor",panel:{role:"application",ariaRemember:!0,html:h,onclick:l},onclick:m})});