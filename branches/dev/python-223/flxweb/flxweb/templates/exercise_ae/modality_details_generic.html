{% extends 'details/modalities/modality_common.html' %}

{% from "macros/artifact.html" import ck12_metadata_keywords_list with context %}
{% from "macros/artifact.html" import ck12_metadata_list_for_standards with context %}
{% from "macros/artifact.html" import ck12_metadata_attributions_list with context %}

{% from "macros/modality_actions.html" import ck12_modality_add_to_fb with context %}
{% from "macros/modality_actions.html" import ck12_modality_edit with context %}
{% from "macros/modality_actions.html" import ck12_modality__download_pdf_html with context %}
{% from "macros/modality_actions.html" import ck12_modality_report_error with context %}
{% from "macros/modality_actions.html" import ck12_modality_publish with context %}
{% from "macros/modality_actions.html" import ck12_modality_details with context %}
{% from "macros/modality_actions.html" import ck12_modality_resources with context %}
{% from "macros/modality_actions.html" import ck12_modality_item with context %}

{% block stylesheets %}
{{ super() }}
<link type="text/css" rel="stylesheet" href="{{ h.url_css('details.css') }}" />
<link rel="stylesheet" type="text/css" media="all" href="{{ h.asset_lib('common/vendor/jquery-plugins/appdownload/css/jquery.appdownload.css') }}" />
<style>
	.modalitycontentinnerwrap {
		/* padding: 26px 0; */
	}

	.detailswrap {
		padding-left: 10px;
	}

	.modalitysidebar ul li {
		text-shadow : transparent 0 0 0;
	}

	.modalitylabel {
		padding-left: 15px;
	}

</style>
{% endblock %}

{% block extra_head %}
<script type="text/javascript">
var pageType = "Modality Details";
var pageSubType = "{{c.modality_data.artifact.modality.get('display_label')|escape}}";
</script>
{% endblock %}


{% block modalities_navbar %}
{{ super() }}
<div class="modalities_top_container">
	<div class="modalities-common">
		<ul id="modality_filters_list" class="hide-for-small">
			<li class="mdoalityfilterdropmenuwrap hide">
				<a class="lnk_modality_filter">
					<i class="icon-arrow3_right"></i>
					<span class="group_label">
						<span>More</span>
	   					<br class="show-small"/>
	   					<span>(</span><span id="more-concept-count"></span><span>)</span>
					</span>
				</a>
				<ul id="modality_extra_filter_list" class="drop-menu hide"></ul>
			</li>
		</ul>
		<ul class="modality-actions-mobile show-for-small row">
			<li class="column small-5"><a href="{{ c.concept_url }}#all"><i class="icon-arrow"></i> {{ _('All Modalities') }}</a></li>
			<li class="column small-5"><a class="js-shareGroupLink right" data-sharetype="group" data-artifactID="{{c.modality_data.artifact.get_artifact_id()}}" title="{{ _('Share via Groups') }}">Share to Groups</a>
		</ul>
	</div>
</div>
{% endblock %}

{% block js %}
{{ super() }}
        {% block ads_js %}
        <script language="JavaScript" type="text/javascript">
                require(['main'],function(){
                        require(['flxweb.modalities.common']);
                });
        </script>
        {% endblock %}

	{% block modality_js %}
	<script language="JavaScript" type="text/javascript">
		var artifactID = '{{c.modality_data.artifact.get_artifact_id()}}';
		var artifactRevisionID = '{{c.modality_data.artifact.get_revision_id()}}';
		//require(['main'],function(){
		//	require(['flxweb.details.modality']);
		//});
	</script>
	{% endblock %}
	
	<script language="JavaScript" type="text/javascript">
		require(['main'],function(){
			require(['jquery'],function($){
				$(document).ready(function() {
					$('.modalitysidebar li a.dropdowntop').click(function() {
						var $dropdown = $(this).next('.dropdown');
						if ($dropdown.is(':hidden')) {
							$dropdown.slideDown('slow');
							$(".dividerwrap").addClass("hide");
						}
						else {
							$dropdown.hide('slow');
							$(".dividerwrap").removeClass("hide");
						}
					});
				});
			});
		});
	</script>
{% endblock %}

{% block meta_extra %}
{{ super () }}
 <meta name="google-play-app" content="app-id=org.ck12.app.practice">
 <meta name="apple-itunes-app-internal" content="app-id=909343639">

<meta property="og:title" content="{{ c.domain.name|escape }}" />
<meta property="og:type" content="website" />
<meta property="og:image" content="{{ c.domain|ck12_thumbnail }}" />
<meta property="og:url" content="{{ h.url(c.page_url, qualified=True) }}" />
<meta property="og:description" content="{{ c.modality_data.artifact.summary }}" />
{% endblock %}

{% block schema_itemscope %} itemscope itemtype="http://schema.org/WebPage" {% endblock %}

{% block modalities_left_header %}
<div class="selected_filter"> <span class="js_selected_filter_label">{{ c.modality_data.artifact.modality.get('display_label')|escape }}</span>  <span class="js_selected_filter_count"></span></div>
<div class="difficultywrap detailheader
	{% if c.difficulty_level %}moreitems{% endif %}
	{% if 'levelCount' in c.domain and c.domain.get('levelCount') != 0 %}
		{% for level in [ 'basic', 'at grade', 'advanced' ] %}
			{% if level in c.domain.get('levelCount') %}
				{% if level != c.difficulty_level %}moreitems{% endif %}
			{% endif %}
		{% endfor %}
	{% endif %}
	">
	
	{% if c.modality_data.artifact.get('level') %}
	<div class="itemwrap main">
		<span class="item" title="{{ _("Difficulty") }}">{{ c.modality_data.artifact.get('level', 'At-Grade' )| title }}</span><span class="tip"></span>
	</div>
	{% endif %}
</div>
{% endblock %}

{% block modality_content %}
<!-- Schema.org properties -->
<meta itemprop="description" content="{{ c.modality_data.artifact.summary }}">
<meta itemprop="interactivityType" content="mixed">
<meta itemprop="provider" content="CK-12 Foundation"/>
<meta itemprop="url" content="{{ h.url(c.page_url, qualified=True) }}"/>
<meta itemprop="dateCreated" content="{{ c.modality_data.artifact.created }}" />
<meta itemprop="dateModified" content="{{ c.modality_data.artifact.modified }}" />
<meta itemprop="datePublished" content="{{ c.modality_data.artifact.get_published_date() }}" />
<meta itemprop="version" content="{{ c.modality_data.artifact.getVersionNumber() }}" />
<meta itemprop="useRightsURL" content="http://creativecommons.org/licenses/by-nc/3.0/" />
<meta itemprop="learningResourceType" content="{{ c.modality_data.artifact.modality.get('display_label')|escape }}" />

{% if c.modality_data.artifact.is_concept() %}
    <meta itemprop="timeRequired" content="P20M" />
{% endif %}

{% for age in c.modality_data.artifact.get_age_ranges() %}
    <meta itemprop="typicalAgeRange" content="{{ age }}" />
{% endfor %}
<meta itemprop="intendedEndUserRole" content="student" />

{% if c.modality_data.artifact.is_published() %}
{% endif %}

<div class="row collapse">
	<div class="hide-for-small large-2 columns">
		<div class="modalitysidebar">
			<div class="dividerwrap start hide">
				<div class="divider">
					<div class="top"></div>
				</div>
			</div>
			{% block modality_actions %}
			<ul id="modalitysidebarMenu">
				<li class="modality-info assign-to-class hide hide-for-lti-context"> <a title="Assign to Class" class="signInRequired assign_to_class">Assign to Class</a><span class="assign-info-img icon-Info"></span></li>
				<li class="modality-info assign-to-class hide show-for-lti-context"> <a title="Create Assignment" class="signInRequired assign_to_lms">Create Assignment</a><span class="assign-info-img icon-Info"></span></li>
				<div id="reveal-overlay" class="reveal-modal-bg"></div>	<!-- This change is for PRACTICE MODALITY and QUIZ MODALITY -->
				{% if c.modality_data_json.artifact.revisionInLibrary == None %}
					<li> <a id="add_to_library" title="Add to Library"> Add to Library </a> </li>
				{% else %}
					<li> <a class="already_in_library" title="Already in Library"> Add to Library </a> </li>
				{% endif %}
				<li class="hide-for-lti-context"> <a class="js-shareGroupLink" data-sharetype="group" data-artifactID="{{ c.modality_data.artifact.id }}" title="{{ _('Share via Groups') }}">Share to Groups</a> </li>
                <!-- <li id="testDetail" urlconfig="test_detail"> {{ ck12_modality_details( c.modality_data.artifact ) }} </li> -->
				<!-- <li id="testDetail" class="practice-now-link hide" urlconfig="test_detail"> {{ ck12_modality_item("Practice Now", "Practice Now") }} </li> -->
                {% if c.assessmentType == 'practice' %}
                    <li urlconfig="test_attempts" class="signInRequired testAttempt"> {{ ck12_modality_item("View Progress", "View Progress") }} </li>
                {% else %}
                    <li urlconfig="test_attempts" class="signInRequired testAttempt"> {{ ck12_modality_item("Previous Attempts", "Previous Attempts") }} </li>
                {% endif %}
                {% if c.assessmentType == 'practice' %}
                  <li class="signInRequired  customize-practice hide"> 
                      <a class="exercise_tools_link hide-for-lti-context" href="{{ h.url(controller='exercise',action='create_test',e_title=c.domain.name, encoded_id=c.modality_data.artifact.domain.encodedID, referrer='practice_details', mtype=c.assessmentType, mhandle=c.modality_data.artifact.handle, np=c.concept_url) }}" title="{{ _('Make this your own Quiz') }}">{{ _("Customize") }}</a>
                      <a class="exercise_tools_link show-for-lti-context" href="{{ h.url(controller='exercise',action='create_test',e_title=c.domain.name, encoded_id=c.modality_data.artifact.domain.encodedID, referrer='practice_details', mtype=c.assessmentType, mhandle=c.modality_data.artifact.handle, np=c.concept_url) }}" title="{{ _('Make this your own Quiz') }}" target="lms-context-override">{{ _("Customize") }}</a>
                  </li>
                {% endif %}
                {% if c.user.id == c.modality_data.artifact.creatorID and c.assessmentType == 'quiz' %}
                    <li class="signInRequired" > 
                        <a class="exercise_tools_link hide-for-lti-context" href="{{ h.url(controller='modality',action='edit_test_details', referrer='modality_details', mtype=c.assessmentType, eid=c.domain.encodedID, mhandle=c.modality_data.artifact.handle, realm=realm, e_title=c.domain.name, encoded_id=c.modality_data.artifact.domain.encodedID, np=c.concept_url) }}" title="{{ _('Edit') }}">{{ _("Edit") }}</a>
                        <a class="exercise_tools_link show-for-lti-context" href="{{ h.url(controller='modality',action='edit_test_details', referrer='modality_details', mtype=c.assessmentType, eid=c.domain.encodedID, mhandle=c.modality_data.artifact.handle, realm=realm, e_title=c.domain.name, encoded_id=c.modality_data.artifact.domain.encodedID, np=c.concept_url) }}" title="{{ _('Edit') }}" target="lms-context-override">{{ _("Edit") }}</a>
                    </li>
                {% endif %}
                    <li class="signInRequired create-question hide"> 
                        <a class="exercise_tools_link hide-for-lti-context" href="{{ h.url(controller='exercise_generator',action='addQuestionForExercise_ae',exercise_title=artifact.handle, artifact_type=artifact.artifactType, realm=artifact.realm) }}" title="{{ _('Help us by contributing questions for this exercise') }}">{{ _("Create New Questions") }}</a>
                        <a class="exercise_tools_link show-for-lti-context" href="{{ h.url(controller='exercise_generator',action='addQuestionForExercise_ae',exercise_title=artifact.handle, artifact_type=artifact.artifactType, realm=artifact.realm) }}" title="{{ _('Help us by contributing questions for this exercise') }}" target="lms-context-override">{{ _("Create New Questions") }}</a>
                    </li>
        
              <li class="ellipse hide-for-lti-context"> 
           	  <a class="dropdowntop icon-ellipsis"> </a>
           	  <ul class="dropdown" style="overflow: hidden; display: none;">
						<li>
							<a class="{% if not c.user %}js_signinrequired{% else %}js_renderlink{% endif %} pdf" title="Download PDF"
								{% if artifact.url_pdf and artifact.url_pdf[0] %}href="{{ artifact.url_pdf[0] }}"{% else %} href="#" {% endif %} 
								data-rendertype="pdf" data-artifactid="{{ artifact.artifactID }}" data-artifactrevisionid="{{ artifact.artifactRevisionID }}" 
								data-rendertemplatetype="onecolumn">{{ _('Download PDF') }}<!-- <span class="popupbubble">{{ _('Most Devices') }}</span> --></a>
						</li>
						<li>
							<a class="{% if not c.user %}js_signinrequired{% else %}js_renderlink{% endif %} html" title="Download HTML"
								{% if artifact.url_html %}href="{{ artifact.url_html }}"{% else %} href="#" {% endif %} 
								data-rendertype="html" data-artifactid="{{ artifact.artifactID }}" data-artifactrevisionid="{{ artifact.artifactRevisionID }}">{{ _('Download HTML') }}<!-- <span class="popupbubble">{{ _('Most Devices') }}</span> --></a>
						</li>
						
						<li class="embedUrl" urlconfig="embed_test"> {{ ck12_modality_item("Embed", "Embed") }} </li>
						<div id="embedModal"></div>
						<!-- <div class="embed-modal hide ">
								<div class="row collapse">
									<h3 class="heading background-primary">Use the code below to embed this test</h3>
									<div class="embed-container">
											<textarea class="text-container" id="embedIframe" contenteditable="true">
											</textarea>
										<div class="text-small">
										</div>
						</div>
					</div>
						</div> -->
				</ul>
			</li>
			</ul>
			{% endblock %}
			<div class="dividerwrap end">
				<div class="divider">
					<div class="top"></div>
				</div>
				<div class="divider">
					<div class="bottom"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="small-12 large-10 columns modalityouter">
		<div class="row collapse modalitycontentwrap">
		<div class="modalitycontentouterwrap">
			<div class="modalitycontentinnerwrap">
	
				<div class="row collapse">
					<div class="modalitylabel group_{{c.modality_group['group_classname']}}">
						<div class="title break-word {% if not c.modality_data.artifact.contributor %}titleonly{% endif %}">
							{% if c.assessmentType == 'practice' and c.collection_data_json and c.collection_data_json.collection and c.collection_data_json.collection.descendantCollection and c.collection_data_json.collection.descendantCollection.title %}
								{{ c.collection_data_json.collection.descendantCollection.title|escape }}
							{% else %}	
								{{ c.modality_data.artifact.get('title')|escape }}
								{# c.modality_data.artifact.modality.get('display_label')|escape #}
							{% endif %}
						</div>
						{% if c.modality_data.artifact.contributor %}
							<div class="contributedby">
								{{ c.modality_data.artifact.contributor }} {{ _(" Contributed ") }} 
							</div>
						{% endif %}
						{% if c.modality_data.artifact.creator %}
							<div class="contributedby">
								{{ _(" By  ") }} {{ c.modality_data.artifact.creator }} 
							</div>
						{% endif %}
					</div>
				</div>
				<div class="modalitycontent">
				{% block before_modality_content_main %}{% endblock %}
				{% block modality_content_main %}
					{% if c.modality_data.artifact.is_resource() %}
						{% set resource = c.modality_data.artifact.get_modality_resource() %}
						{% if resource.thumbnail %}
						<div class="thumb_imgwrap">
						<a href="/flx/show{{ resource.permaUri }}"><img class="modality_resource_thumb" src="{{ resource.thumbnail }}" title="{{ resource.name }}" alt="{{ resource.name }}" /></a> 
						</div>
						{% endif %}
						<div class="modality_resource_desc">
							{{ resource.description|escape|replace("None", "") }}
						</div> 
						<div class="divider spacetop"></div>
						<div>
							<a class="button turquoise download" href="/flx/show{{ resource.permaUri }}">{{ _('Download') }}</a>
						</div>
						<div class="divider"></div>
					{% else %}
						{{ c.modality_xhtml }}
					{% endif %}
				{% endblock %}
				{% block after_modality_content_main %}{% endblock %}
				</div>
				<div class="gclear"></div>
				<div class="detailswrap">
					<!-- START METADATA VIEW -->
					{% block modality_metadata %}
					
					{# hide modality details for student users #}
		            {% if c.show_details %}
					<h3 class="js_block_toggle js_metadata_toggle" data-toggle=".js_metadata_toggle" data-container=".js_metadata_container">
					    <span class="show">{{ _('Show') }}</span><span class="noshow hide">{{ _('Hide') }}</span> {{ _('Details') }} <span class="tip"></span>
					</h3>
					<div class="divider"></div>
					<div class="js_metadata_container" id="js_metadata_container_mjax" style="display:none;">
						<div class="metadataview">
							<div class="left">
								{% block before_metadata %}
								{% endblock %}
								<section>
									{% set _attributions = c.modality_data.artifact.get_authors_by_role() %}
									<!-- Authors List -->
									{% if 'author' in _attributions %}
									<div class="spacetopmedium break-word">
										{{ ck12_metadata_attributions_list( _("Authors:"), _attributions.get('author') ) }}
									</div>
									{% endif %}
									
									<!-- Contributors List -->
									{% if 'contributor' in _attributions %}
									<div class="spacetopmedium break-word">
										{{ ck12_metadata_attributions_list( _("Contributors:"), _attributions.get('contributor') ) }}
									</div>
									{% endif %}
							
									<!-- Editors List -->
									{% if 'editor' in _attributions %}
									<div class="spacetopmedium break-word">
										{{ ck12_metadata_attributions_list( _("Editors:"), _attributions.get('editor') ) }}
									</div>
									{% endif %}
							
									<!-- Translators List -->
									{% if 'translator' in _attributions %}
									<div class="spacetopmedium break-word">
										{{ ck12_metadata_attributions_list( _("Translators:"), _attributions.get('translator') ) }}
									</div>
									{% endif %}
									
									<!-- Reviewer List -->
		                            {% if 'reviewer' in _attributions %}
		                            <div class="spacetopmedium break-word">
		                                {{ ck12_metadata_attributions_list( _("Reviewer:"), _attributions.get('reviewer') ) }}
		                            </div>
		                            {% endif %}
		                            
		                            <!-- Technical Reviewer List -->
		                            {% if 'technicalreviewer' in _attributions %}
		                            <div class="spacetopmedium break-word">
		                                {{ ck12_metadata_attributions_list( _("Technical Reviewer:"), _attributions.get('technicalreviewer') ) }}
		                            </div>
		                            {% endif %}
		                            
								</section>
								<section>
									<!-- Objectives -->
									{% block metadata_objectives %}
									{% endblock %}
								</section>
								<section>
									<!-- Source List -->
									{% if 'source' in _attributions %}
									<div class="spacetopmedium break-word">
										{{ ck12_metadata_attributions_list( _("Sources:"), _attributions.get('source') ) }}
									</div>
									<div class="divider spacetopmedium"></div>
									{% endif %}
								</section>
								<!-- Related Materials -->
								{% block related %}
								<section id="related" class="relatedmaterials" >
									{% if c.related_list %}
										<h2 class="toptitle">{{ _("%(relation)s Materials"  % {'relation':c.relation_type.title()}) }}</h2>
										<ul>
										{% for artifact in c.related_list %}
										<li>
											<a href="{{ config.webroot_url }}{{ artifact.perma }}" title="{{ artifact.title|escape }}">
												{{ artifact.title }}
											</a>
										</li>
										{% endfor %}
										</ul>
									{% endif %}
								</section>
								{% endblock %}
								<section>
									{% if c.modality_data.artifact.level %}
									<div class="spacetopmedium">
										<h2 class="toptitle">{{ _("Difficulty Level") }}</h2> {{ c.modality_data.artifact.get_level()|title }}
									</div>
									{% endif %}
									
									<!-- Grades -->
									{% if c.modality_data.artifact.get_grades() %}
									<div class="columnwrap spacetopmedium">
										<h2 class="toptitle"> {{  _("Grades") }} </h2>
										<div class="">
										 {% for grade in c.modality_data.artifact.get_grades() %}
										  <a href="{{ url('search') }}?q=grade:{{ grade['name'] }}" title="{{ grade['name'] }}"><span>{{ grade['name'] }} </span></a>
										  {% if not loop.last %},{% endif %} 
										 {% endfor %} 
										</div>
									</div>
									
									{% endif %}
								</section>
							</div>
							
							<div class="right">
								<section>
									<div class="spacetopmedium">
										<h2 class="toptitle infoitemname" data-date="">{{ _("Date Created:") }}</h2>
										<span class="js_local_date" data-date="{{ c.modality_data.artifact.created }}"></span>
									</div>
									<div>
										<h2 class="toptitle infoitemname">{{ _("Last Modified:") }}</h2>
										<span class="js_local_date" data-date="{{ c.modality_data.artifact.modified }}"></span>
									</div>
								</section>
								<section>
									<!-- Categories -->
									{% if c.modality_data.artifact.get_subjects() %}
									<div class="spacetopmedium">
										{{ ck12_metadata_keywords_list( _("Subjects:"), c.modality_data.artifact.get_subjects() ) }}
									</div>
									<div class="clear"></div>
									{% endif %}
								</section>
								<section>
		                            {% if c.modality_data.artifact.get_seo_keywords() %}
		                            <div class="spacetopmedium">
		                                {{ ck12_metadata_keywords_list( _("Search Keywords:"), c.modality_data.artifact.get_seo_keywords_grid(), separator=";" ) }}
		                            </div>
		                            <div class="clear"></div>
		                            {% endif %}
								</section>
								<section>
									<!-- Tags -->
									{% if c.modality_data.artifact.get_tags() %}
									<div class="spacetopmedium">
										{{ ck12_metadata_keywords_list( _("Tags:"), c.modality_data.artifact.get_tags() ) }}
									</div>
									{% endif %}
								</section>
								<!-- Other Details -->
								<section>
									<!-- Standards Correlations (Replaced States - SLING) -->
									{% block standard_correlations %}
									{% endblock %}
		
									<!--<h2>{{ _("Other Details") }}</h2>-->
									
									{% block metadata_concept_node %}
									{% endblock %}
									
									{% block extra_metadata %}
									{% endblock %}
								</section>
							</div>
							<div class="clear"></div>
						</div>
						<div class="spacetop"></div>
						<div class="divider"></div>
					</div>
					{% endif %}
		            {# --end hide modality details for student users #}
					<div class="after_metadata">
					    {% block after_metadata %}
					    {% endblock %}
					</div>
					{% endblock %}
					<!-- /END METADATA VIEW -->
				</div>
			</div><!-- /END modalitycontentinnerwrap -->
		</div><!-- /END modalitycontentouterwrap -->
	</div>
	</div>
		
</div>
{% endblock %}

{% block artifact_review_feedback %}
	<div class="column large-12 hide-for-small">
		<div id="review_list_container" class="relative js_loadlater" data-native="flxweb.modality.read.initreviewlist" data-lazyload="1">
			<!-- Bottom Artifact Review Feedback -->
			{{ ck12_artifact_review_feedback_bottom( ) }}
			<!-- /Bottom Artifact Review Feedback -->
			<!-- Artifact Voting -->
			{{ ck12_artifact_myreview_feedback( ) }}
			<!-- /Artifact Voting -->
		</div>
	</div>
{% endblock %}

{% block hidden_divs %}
{{ super() }}

<!--
	Templates for groups sharing 
-->
{% include "jstemplates/share_groups.html" %}

{% endblock %}

{% block no_modalities %}{% endblock %}
