{% extends "base/1column.html" %}

{% block stylesheets %}
{{ super() }}
<style>
   body.fireworks{
      background: #000;
      color: #FFF;
    }
    #saythanks.fireworks{
      color: white !important;
    }
    #saythanks.fireworks h1 {
      color: white !important;
    }
    .fireworks {
        background-image: url('http://www.picgifs.com/graphics/f/fireworks/graphics-fireworks-682202.gif');
    }
      .fire {
                  animation: burn 1.5s linear infinite alternate;
          -webkit-animation: burn 1.5s linear infinite alternate;
             -moz-animation: burn 1.5s linear infinite alternate;
              -ms-animation: burn 1.5s linear infinite alternate;        
      }

      @keyframes burn {
            from { text-shadow: -.1em 0 .3em #fefcc9, .1em -.1em .3em #feec85, -.2em -.2em .4em #ffae34, .2em -.3em .3em #ec760c, -.2em -.4em .4em #cd4606, .1em -.5em .7em #973716, .1em -.7em .7em #451b0e; }
            45%  { text-shadow: .1em -.2em .5em #fefcc9, .15em 0 .4em #feec85, -.1em -.25em .5em #ffae34, .15em -.45em .5em #ec760c, -.1em -.5em .6em #cd4606, 0 -.8em .6em #973716, .2em -1em .8em #451b0e; }
            70%  { text-shadow: -.1em 0 .3em #fefcc9, .1em -.1em .3em #feec85, -.2em -.2em .6em #ffae34, .2em -.3em .4em #ec760c, -.2em -.4em .7em #cd4606, .1em -.5em .7em #973716, .1em -.7em .9em #451b0e; }
            to   { text-shadow: -.1em -.2em .6em #fefcc9, -.15em 0 .6em #feec85, .1em -.25em .6em #ffae34, -.15em -.45em .5em #ec760c, .1em -.5em .6em #cd4606, 0 -.8em .6em #973716, -.2em -1em .8em #451b0e; }                        
      }
        
      @-webkit-keyframes burn {
            from { text-shadow: -.1em 0 .3em #fefcc9, .1em -.1em .3em #feec85, -.2em -.2em .4em #ffae34, .2em -.3em .3em #ec760c, -.2em -.4em .4em #cd4606, .1em -.5em .7em #973716, .1em -.7em .7em #451b0e; }
            45%  { text-shadow: .1em -.2em .5em #fefcc9, .15em 0 .4em #feec85, -.1em -.25em .5em #ffae34, .15em -.45em .5em #ec760c, -.1em -.5em .6em #cd4606, 0 -.8em .6em #973716, .2em -1em .8em #451b0e; }
            70%  { text-shadow: -.1em 0 .3em #fefcc9, .1em -.1em .3em #feec85, -.2em -.2em .6em #ffae34, .2em -.3em .4em #ec760c, -.2em -.4em .7em #cd4606, .1em -.5em .7em #973716, .1em -.7em .9em #451b0e; }
            to   { text-shadow: -.1em -.2em .6em #fefcc9, -.15em 0 .6em #feec85, .1em -.25em .6em #ffae34, -.15em -.45em .5em #ec760c, .1em -.5em .6em #cd4606, 0 -.8em .6em #973716, -.2em -1em .8em #451b0e; }                        
      }
        
      @-moz-keyframes burn {
            from { text-shadow: -.1em 0 .3em #fefcc9, .1em -.1em .3em #feec85, -.2em -.2em .4em #ffae34, .2em -.3em .3em #ec760c, -.2em -.4em .4em #cd4606, .1em -.5em .7em #973716, .1em -.7em .7em #451b0e; }
            45%  { text-shadow: .1em -.2em .5em #fefcc9, .15em 0 .4em #feec85, -.1em -.25em .5em #ffae34, .15em -.45em .5em #ec760c, -.1em -.5em .6em #cd4606, 0 -.8em .6em #973716, .2em -1em .8em #451b0e; }
            70%  { text-shadow: -.1em 0 .3em #fefcc9, .1em -.1em .3em #feec85, -.2em -.2em .6em #ffae34, .2em -.3em .4em #ec760c, -.2em -.4em .7em #cd4606, .1em -.5em .7em #973716, .1em -.7em .9em #451b0e; }
            to   { text-shadow: -.1em -.2em .6em #fefcc9, -.15em 0 .6em #feec85, .1em -.25em .6em #ffae34, -.15em -.45em .5em #ec760c, .1em -.5em .6em #cd4606, 0 -.8em .6em #973716, -.2em -1em .8em #451b0e; }                        
      }
        
      @-ms-keyframes burn {
            from { text-shadow: -.1em 0 .3em #fefcc9, .1em -.1em .3em #feec85, -.2em -.2em .4em #ffae34, .2em -.3em .3em #ec760c, -.2em -.4em .4em #cd4606, .1em -.5em .7em #973716, .1em -.7em .7em #451b0e; }
            45%  { text-shadow: .1em -.2em .5em #fefcc9, .15em 0 .4em #feec85, -.1em -.25em .5em #ffae34, .15em -.45em .5em #ec760c, -.1em -.5em .6em #cd4606, 0 -.8em .6em #973716, .2em -1em .8em #451b0e; }
            70%  { text-shadow: -.1em 0 .3em #fefcc9, .1em -.1em .3em #feec85, -.2em -.2em .6em #ffae34, .2em -.3em .4em #ec760c, -.2em -.4em .7em #cd4606, .1em -.5em .7em #973716, .1em -.7em .9em #451b0e; }
            to   { text-shadow: -.1em -.2em .6em #fefcc9, -.15em 0 .6em #feec85, .1em -.25em .6em #ffae34, -.15em -.45em .5em #ec760c, .1em -.5em .6em #cd4606, 0 -.8em .6em #973716, -.2em -1em .8em #451b0e; }                        
      }

      .center {
          position: absolute;
          margin: auto;
          top: 50%; 
          left: 50%;
          text-align: center;         
          -webkit-transform: translate(-50%, -50%);
             -moz-transform: translate(-50%, -50%);       
              -ms-transform: translate(-50%, -50%);
                  transform: translate(-50%, -50%);       
          font-family: 'AvenirNext-Heavy', 'Arial Black', sans-serif;
          font-stretch: ultra-condensed;
          font-size: 600%;
          font-size: 12vmin;
          font-weight: 900; 
          font-style: italic;         
          white-space: nowrap;
          color: black; 
          text-decoration: none;                          
      }
      
      .center b {
          display: block;
          font-size: 25%;
          margin-top: -3%;
          padding: 1% 7%;
          font-family: monospace;
          font-weight: normal;
      }
          
      .center:hover b {
          color: white;
          background-color: black;
      }
</style>
{% endblock %}

{% block js %}
{{ super() }}
  <script>
    function getXHR(){
      return new XMLHttpRequest();
    }

    Number.prototype.format = function(n, x) {
      var re = '\\d(?=(\\d{' + (x || 3) + '})+' + (n > 0 ? '\\.' : '$') + ')';
      return this.toFixed(Math.max(0, ~~n)).replace(new RegExp(re, 'g'), '$&,');
    };

    var celebrating = false;
    var inc = 0;
    var showingFireworks = false;
    function poll(){
      inc++;
      var req = getXHR();
      var stats = document.getElementById('statsCount');
      

      //fetch install counts
      req.open('GET','/flx/get/downloadStats',true);
      req.responseType = 'json';
      req.onload = function(){
        var res = req.response;
        if (typeof res == 'string') {
          res = JSON.parse(res);
        }
        var latestCount = Number(res.response.downloadstats.replace(/,/g,'')) + inc;
        var html = res.response.downloadstats;
        var d = document.getElementById('contentwrap');
        var when = window.location.href.match(/when\=(.*)/)[1];
        when = Number(when); 
        if (latestCount >= when){
        	if ('classList' in document.createElement('a')) {
            	d.classList.add('fireworks');
            	document.getElementsByTagName('body')[0].classList.add('fireworks');
            	document.getElementById('saythanks').classList.add('fireworks');
        	} else { // IE-9 :(
        		d.className += 'fireworks';
        		document.getElementsByTagName('body')[0].className += 'fireworks';
        		document.getElementById('saythanks').className += 'fireworks';
        	}
            var template = '<em class="fire" style="animation-delay: $DELAYs; -webkit-animation-delay: $DELAYs; -moz-animation-delay: $DELAYs; -ms-animation-delay: $DELAYs;">$NUMBER</em>';
            var num = res.response.downloadstats;
            html = '';
            for (var i=0;i<num.length;i++) {
                var tmp = template;
                var delay = parseFloat( (1/num.length) * i).toFixed(2);
                tmp = tmp.replace(/\$NUMBER/g,num[i]);
                tmp = tmp.replace(/\$DELAY/g,delay);
                html += tmp;
            }
            stats.innerHTML = html;
            showingFireworks = true;
        } else {
          stats.innerHTML = html;
          if ('classList' in document.createElement('a')) {
          	d.classList.remove('fireworks');
          } else { // IE-9 :(
			d.className = d.className.replace(/\bfireworks\b/, '');
          }
          showingFireworks = false;
        }
      };
      req.send();
   }
    if (window.location.href.indexOf('celebrate=yes') != -1) {
        window.setInterval(function() {
            if (!showingFireworks) {
                poll();
            }
         },
         3 * 1000);
        poll();
    }
  </script>
{% endblock %}


{% block content %}
<div id="saythanks">
	<h1>{{ _("Thank you!") }}</h1>
	<p>
		<span id="statsCount" class="count">{{c.downloadstats}}</span> {{ _("contents delivered...") }}
	</p>
</div>
<div id="celebration" style="display:none">
     <img src="http://riccialexis.com/wp-content/uploads/2013/07/fireworks.gif" /> 
</div>
{% endblock %}
