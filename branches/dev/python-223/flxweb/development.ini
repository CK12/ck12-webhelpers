#
# flxweb - Pylons development environment configuration
#
# The %(here)s variable will be replaced with the parent directory of this file
#
[DEFAULT]
# WARNING: *THE LINE BELOW MUST BE UNCOMMENTED ON A PRODUCTION ENVIRONMENT*
# Debug mode will enable the interactive debugging tool, allowing ANYONE to
# execute malicious code after an exception is raised.
set debug = False

# Production Or development environment flag. Accepts "true" or "false"
# Can be used to different the deployed environment and do/not-do some actions
production = false

# Uncomment and replace with the address which should receive any error reports
#email_to = dev-errors@ck12.org
smtp_server = localhost
error_email_from = ck12operations@ck12.org
error_subject_prefix = [FLXWEB Error on gandalf.ck12.org]

[server:main]
use = egg:gunicorn#main
workers = 5
worker_connections = 1000
max_requests = 0
timeout = 180
keepalive = 2
host = 0.0.0.0
port = 9000

[app:main]
use = egg:flxweb
full_stack = true
static_files = true

cache_dir = %(here)s/data/cache
#############################
# Session Settings
#############################
beaker.session.key = flxweb
beaker.session.secret = somesecret
beaker.session.secure = True
# session timeout in seconds
beaker.session.timeout = 86400
beaker.session.data_dir = %(here)s/data/sessions
# MongoDB backend settings
#beaker.session.type = mongodb
#beaker.session.url = mongodb://sessionsadmin:D-coD43@localhost:27017/sessions.FlxwebSessions
#beaker.session.sparse_collection = True
#beaker.session.skip_pickle = True
#beaker.session.replica_set = rs0
#beaker.session.max_pool_size = 5

##############################
# Beaker cache settings
# Note cache expire time is in seconds
##############################
enable_nocache_parameter = True
# Memory (For development. Applicable to all regions)
beaker.cache.type = redis
beaker.cache.data_dir = %(here)s/data/cache
beaker.cache.regions = short_term, long_term, daily,forever
beaker.cache.short_term.expire = 900
beaker.cache.long_term.expire = 6000
#daily (i.e 24 hours) cache
beaker.cache.daily.expire = 86400
#forever (expires in 1 year)
beaker.cache.forever.data_dir = %(here)s/data/static_cache
beaker.cache.forever.type = redis
beaker.cache.forever.expire = 31536000

# Memcache settings (For production.Each region needs its own settings)
beaker.cache.short_term.url = localhost:6379
beaker.cache.long_term.url = localhost:6379
beaker.cache.daily.url = localhost:6379
beaker.cache.forever.url = localhost:6379

##############################
# JS/CSS URL settings.
##############################

# set to true to enable the use CDN for static assets.
cdn_enabled = false

# specify the cdn locations along with protocol and port
# multiple urls can be specified separated by comma
# NOTE: Use protocol-relative URLs only (eg: //st1.ck12.org and NOT https://st1.ck12.org)
# example :
# static_cdn_locations = //cdn1.ck12.org, //cdn2.ck12.org
# static_cdn_locations, serve css,js
static_cdn_locations = //st1.ck12.org, //st2.ck12.org, //st3.ck12.org
# img_cdn_locations, serve the static images
img_cdn_locations = //img1.ck12.org, //img2.ck12.org, //img3.ck12.org

# Webroot_url aka context root.
webroot_url = /

# Static Media URLs
# for production: use the relative location of media directory from host/cdn location
# for development: use /media
url_media = /media

# URL for static images
url_images =%(url_media)s/images/

# URL for JS files
url_js =%(url_media)s/js/

# URL for CSS files
url_css =%(url_media)s/css/

# URL for
url_lib =%(url_media)s/lib/

#JS Settings for flxweb
#js_settings = %(url_js)s/flxweb.settings.js
url_js_settings = /js/settings/

assessment_base_url = /assessment/ui/

#peerhelp_base_url = /peerhelp/ui/build-20150908114042
peerhelp_base_url = /peerhelp/ui/build-20150908114042

## Max size 25 MB = 25*1024*1024
attachment_max_upload_size = 26214400

## Max size 2MB == 25*1024*1024
profile_image_max_upload_size = 2097152

#############################
# CDN API
#############################
cdn_api_cache = api-gamma.ck12.org
cdn_api_version = 20170721

#############################
#BOXVIEWER SETTINGS
#############################
box_iframe_url = https://view-api.box.com/1/sessions/

#############################
# FLX AUTH API SETTINGS
#############################
flx_auth_api_server = https://gandalf.ck12.org/auth
# the cookie name should be set to the auth-<auth server subdomain>
ck12_login_cookie = auth-gandalf
# API timeout setting (in seconds)
flx_auth_api_timeout = 180

#############################
# FLX CORE API SETTINGS
#############################
flx_core_api_server = https://gamma.ck12.org/flx
flx_write_api_server = https://gamma.ck12.org/wr/flx
# API timeout setting (in seconds)
flx_core_api_timeout = 180

#############################
# CK12 ADS API SETTINGS
#############################
ads_enabled=true
ads_api_server = https://chaplin.ck12.org/dexter
ads_js = https://chaplin.ck12.org/dexter/media/js/quizlog.js
ads_logging_api = /dexter/record/event
fbs_client_id = 24839961
# API timeout setting (in seconds)
ads_api_timeout = 180

#############################
# HWP API SETTINGS
#############################
hwp_api_server = https://gamma.ck12.org/hwp
# API timeout setting (in seconds)
hwp_api_timeout = 180

#############################
# Assessment API SETTINGS
#############################
assessment_api_server = https://qa-yoda.ck12.org/assessment/api
# API timeout setting (in seconds)
assessment_api_timeout = 180

#############################
# TAXONOMY API SETTINGS
#############################
taxonomy_api_server = https://qa-yoda.ck12.org/taxonomy
# API timeout setting (in seconds)
taxonomy_api_timeout = 180

#############################
# Search Page Parameters
#############################
search_page_size = 10

#############################
# Browse Page Parameters
#############################
# maximum levels of the concept/browse tree to be fetched
browse_tree_max_level = 2
# EncodedID of Root of the concept grid
browse_concept_grid_root = CKT

#############################
# MyLibrary Page Parameters
#############################
mylibrary_page_size = 10

#############################
# Pagination parameters
#############################
pagination_number_of_pages_show = 3

#############################
# Default cover images
#############################
default_book_cover_large = /media/images/thumb_dflt_flexbook_lg.png
default_book_cover_small = /media/images/thumb_dflt_flexbook_sm.png

default_chapter_cover_large = /media/images/thumb_dflt_chapter_lg.png
default_chapter_cover_small = /media/images/thumb_dflt_chapter_sm.png

default_lesson_cover_large = /media/images/thumb_dflt_lesson_lg.png
default_lesson_cover_small = /media/images/thumb_dflt_lesson_sm.png

default_concept_cover_large = /media/images/thumb_dflt_concept_lg.png
default_concept_cover_small = /media/images/thumb_dflt_concept_sm.png

# default cover if artifact type is not available
# note: this should not be the case, this is added as fail safe
default_cover_thumbnail_large = /media/images/thumb_dflt_lesson_lg.png
default_cover_thumbnail_small = /media/images/thumb_dflt_lesson_sm.png


#############################
# Build information
# is displayed in the footer
#############################
build_major_version = GROUP_EDITING 
build_minor_version = 53941
build_svn_info_file = %(here)s/build.info

##############################
# Registration/Login/Logout settings
##############################
# URL to redirect to after success full login
login_success_url = /

##############################
# Facebook Settings
##############################
# Facebook APP ID
fb_app_id = 159884644067996

###############################
# Google Tag Manager
###############################
gtm_enabled=true
gtm_container = GTM-WVB47G

###############################
# Google Analytics
###############################
ga_account=UA-33406409-1
ga_domain=.ck12.org

###############################
# Resource Upload
###############################

#location where uploaded file-like objects should go to
#before they are uploaded to the create/update resource endpoint
resource_upload_dir = /opt/gluster/qa_cluster/shared_data/flxweb-uploads/

#if upload directory is shared with server, set this to true
#to avoid double-uploading of files
resource_upload_dir_shared = false

###############################
# TINYMCE CONFIGURATION
###############################

#enables tinymce gzip compressor when set to true.
#setting this to false can be useful for debugging.
tinymce_use_gzip=true

tinymce_default_plugins=pagebreak, xhtmlxtras, autolink, save, inlinepopups, lists, advlist, advimage, advlink, paste, contextmenu, fullscreen
tinymce4_default_plugins=code, fullpage, hr, insertdatetime, nonbreaking, lists, paste, preview, save, searchreplace, tabfocus, visualblocks, visualchars, wordcount

#list of external plugins (mostly ck-12) used with tinymce
tinymce_ck12_plugins=matheditor, ck12image, ck12rosetta, ck12paste, ck12embed, elementbox, ck12autoresize, ck12table, ck12indent, ck12definitionlist, ck12link, ck12validator, ck12spellchecker
tinymce4_ck12_plugins=autolink, ck12image, ck12advlist, ck12contextmenu, ck12charmap, ck12fullscreen, matheditor, ck12rosetta, ck12pagebreak, ck12paste, ck12embed, elementbox, ck12autoresize, ck12table, ck12color, ck12definitionlist, ck12link, ck12validator, ck12indent, ck12spellchecker, ck12alignment, ck12eventmanager

#list of external plugins used with tinymce for qcreate exercise
tinymce_create_exercise_plugins=mathimage, matheditor, ck12image, ck12rosetta, ck12paste, ck12embed, ck12autoresize, ck12table, ck12indent, ck12spellchecker

#path to javasript lib directory
media_lib_path =%(here)s/flxweb/public%(url_lib)s

#path to tinymce
tinymce_path = %(here)s/flxweb/public/media/lib/tinymce/jscripts/tiny_mce/
tinymce4_path = %(here)s/flxweb/public/media/lib/tinymce4/js/tinymce/

#path to ck12 plugins for tinymce
tinymce_ck12_plugin_path =  %(here)s/flxweb/public/media/lib/ck12-tinymce-plugins/
tinymce4_ck12_plugin_path =  %(here)s/flxweb/public/media/lib/ck12-tinymce4-plugins/

#URL to ck12 plugins for tinymce
tinymce_ck12_plugins_url = %(url_media)s/lib/ck12-tinymce-plugins/
tinymce4_ck12_plugins_url = %(url_media)s/lib/ck12-tinymce4-plugins/

###############################
# author role allowed edit some fields
###############################
edit_allowed_roles = author,admin,content-admin,support-admin,content-de-author-admin

##############################
# Valid/Allowed branches
# 1. This list controls the branches show on pages like landing, browse
# and 404 pages. Individual branches can be show/hidden using the "show" field.
#
# 2. Allows the urls like /<branch-slug>/<concept-handle>/
#
# 3. Controls which browse pages show the concept map button.
# The 'map' field on the individual branches decide if concept map is available
# for that branch.
##############################
valid_branches = [ {'name': 'Math', 'children' : [
                    {'name':'Arithmetic','slug':'arithmetic','map':1,'show':1},
                    {'name':'Measurement','slug':'measurement','map':1,'show':1},
                    {'name':'Algebra','slug':'algebra','map':1,'show':1},
                    {'name':'Geometry','slug':'geometry','map':1,'show':1},
                    {'name':'Probability','slug':'probability','map':1,'show':1},
                    {'name':'Statistics','slug':'statistics','map':1,'show':1},
                    {'name':'Trigonometry','slug':'trigonometry','map':1,'show':1},
                    {'name':'Analysis','slug':'analysis','map':1,'show':1},
                    {'name':'Calculus','slug':'calculus','map':1,'show':1},
                    {'name':'Elementary Math','slug':'elementary-math','map':0,'show':0},
                    {'name':'Elementary Math Grade 1','slug':'elementary-math-grade-1','map':0,'show':0},
                    {'name':'Elementary Math Grade 2','slug':'elementary-math-grade-2','map':0,'show':0},
                    {'name':'Elementary Math Grade 3','slug':'elementary-math-grade-3','map':0,'show':0},
                    {'name':'Elementary Math Grade 4','slug':'elementary-math-grade-4','map':0,'show':0},
                    {'name':'Elementary Math Grade 5','slug':'elementary-math-grade-5','map':0,'show':0}
                ]},
                {'name': 'Science', 'children':[
                    {'name':'Earth Science','slug':'earth-science','map':1,'show':1},
                    {'name':'Life Science','slug':'life-science','map':1,'show':1,'link':['Biology'], 'cross_over_link':'hs'},
                    {'name':'Physical Science','slug':'physical-science','map':1,'show':1,'link':['Physics','Chemistry'],'cross_over_link':'hs'},
                    {'name':'Biology','slug':'biology','map':1,'show':1,'link':['Life Science'],'cross_over_link':'ms'},
                    {'name':'Chemistry','slug':'chemistry','map':1,'show':1,'cross_over_link':'ms','link':['Physical Science']},
                    {'name':'Physics','slug':'physics','map':1,'show':1,'link':['Physical Science'], 'cross_over_link':'ms'}
                ]},
                {'name':'English','children':[
                    {'name':'English','slug':'english','map':0,'show':0},
                    {'name':'Writing','slug':'writing','map':0,'show':1},
                    {'name':'Spelling','slug':'spelling','map':0,'show':1},
                    {'name':'Speaking & Listening','slug':'speaking-&-listening','map':0,'show':0},
                    {'name':'Reading','slug':'reading','map':0,'show':0},
                    {'name':'Literary Periods & Movements','slug':'literary-periods-&-movements','map':0,'show':0},
                    {'name':'Literary Genres & Text Types','slug':'literary-genres-&-text-types','map':0,'show':0},
                    {'name':'Language & Grammar','slug':'language-grammar','map':0,'show':0},
                    {'name':'Foundations of Reading','slug':'foundations-of-reading','map':0,'show':0}
                ]},
                {'name': 'More', 'children':[
                    {'name':'Engineering','slug':'engineering','map':0,'show':1},
                    {'name':'Technology','slug':'technology','map':0,'show':1},
                    {'name':'Astronomy','slug':'astronomy','map':0,'show':1},
                    {'name':'History','slug':'history','map':0,'show':1},
                    {'name':'Health','slug':'health','map':0,'show':1},
                    {'name':'SAT Exam Prep.','slug':'sat-exam-prep','map':0,'show':0},
                    {'name':'Economics','slug':'economics','map':0,'show':0},
                    {'name':'Software Testing','slug':'software-testing','map':0,'show':0},
                    {'name':'na','slug':'user-generated-content','map':0,'show':0}
                ]}]

##############################
# Valid/Allowed Subjects.
# Used to display on landing/browse pages
##############################
valid_subjects = MAT,SCI,ELA

###############################
# Create Modality Type and Display name
# information to show in drop-down
###############################

#modality_types =lesson,rwa,rwaans,preread,prereadans,postread,postreadans,whileread,whilereadans,prepostread,prepostreadans,studyguide,flashcard,lecture
#modality_filter_types =rwa,rwaans,preread,prereadans,postread,postreadans,whileread,whilereadans,prepostread,prepostreadans,studyguide,flashcard,lecture

modality_types =lesson,rwa,preread,postread,whileread,prepostread,studyguide,flashcard,lecture,web
modality_filter_types =rwa,preread,postread,whileread,prepostread,studyguide,flashcard,lecture,web


###############################
# User data Migration from
# previous version i.e 1.x
###############################
enable_migration = false

###############################
# Google Docs import
###############################
flx_cookie_domain = .ck12.org

###############################
# Archive Site Configuration
###############################
archive_site_root = http://skylab.ck12.org/
archive_site_flexr = %(archive_site_root)sflexbook/
archive_site_pdf_prefix = %(archive_site_flexr)spdf/
archive_site_epub_prefix = %(archive_site_flexr)sepub/
archive_site_liveview_prefix = %(archive_site_flexr)sliveview/
archive_site_viewer_prefix = %(archive_site_flexr)sviewer/
archive_site_realm_prefix = %(archive_site_flexr)sbooks/
archive_site_apps_prefix = %(archive_site_flexr)sapps/
archive_site_embed_prefix = %(archive_site_flexr)sembed/view/
#
# list of flexbook IDs that should ALWAYS redirect to archive site
#
archive_redirect_flexbook_ids = 2823, 2878, 2964, 2969, 2963

###############################debug
# Support E-Mail Address
###############################
support_email = support@ck12.org

###############################
# 2.0 Features URL
###############################
features_url = http://www.ck12info.org/about/features/

###############################
# About site prefix url
###############################
about_url = //www.ck12info.org/about

###############################
# Answer keys google form url
###############################
answer_keys_url = https://docs.google.com/spreadsheet/embeddedform?formkey=dFBmYTdnVEdaUWl5OEJ2V21ERnh2Qmc6MQ&entry_20=$EMAIL$&entry_18=$NAME$&entry_24=$URL$

###############################
# hosts url
###############################
hosts = gamma.ck12.org

###############################
# Slow API logging
###############################
# time in seconds
slowapi_time = 3

###############################
# Health Check Host-API
###############################

flx_core_servers_api_mapping_path=%(here)s/flxweb/templates/healthcheck/host_services_settings.xml

# time in seconds
flx_core_servers_api_timeout = 30

###############################
# Modality config
###############################

modality_configuration_path=%(here)s/flxweb/config/shared_config/modality_configuration.xml
modality_configuration_backup_path=%(here)s/flxweb/config/shared_config/

###############################
# Murugan page config
###############################
MURUGAN_SPREADSHEET_KEY = 0AvVvf79yevY3dGdiN2ZZelF3cmUyU3VPdUNLU2QzTVE
# MURUGAN_SPREADSHEET_KEY = 0AvVvf79yevY3dElHaENKeHgxOHRyalVNUzdrUjVHcWc
MURUGAN_FORM_KEY = dGdiN2ZZelF3cmUyU3VPdUNLU2QzTVE6MQ
# MURUGAN_FORM_KEY = dElHaENKeHgxOHRyalVNUzdrUjVHcWc6MA

###############################
# Events config
###############################
events_spreadsheet_key = 0AvVvf79yevY3dEhOd1dPUzd5S2xqSXdzcUdkV0lCa2c

###############################
# ILOs config
###############################
ilo_server_url = https://mirugai.ck12.org

###############################
# "New" flag settings
###############################
#Number of days something is considered 'new'
days_until_new = 7

###############################
# White list of opening external
# links in CK-12 branded page
###############################
external_links_whitelist=%(here)s/flxweb/config/shared_config/external_links_whitelist.txt

###############################
# Flxweb node name
###############################
flxweb_node_name=dev_instance

###############################
# GetReal Judging configuration
###############################
getreal_judging_enabled = true
getreal_judging_entries_top=50debug
getreal_public_judging_enabled=false
getreal_judging_group_name=CK-12 Get Real Judges
getreal_judging_group_creator_id=3
getreal_contribution_enabled=true

###############################
# Top navigation menu selection
# key = URL path
# value = page-name
###############################
nav_names = {'/my/groups/': 'groups',
            '/group': 'groups',
            '/group-members': 'groups',
            '/group-resources': 'groups',
            '/group-settings': 'groups',
            '/my/dashboard/': 'dashboard',
            '/my/bookmarks/': 'bookmarks',
            '/my/content/': 'my_content',
            '/my/tests/': 'my_content',
            '/browse/': 'subjects',
            '/account/settings': 'settings',
            '/flxadmin': 'flxadmin',
            '/modality/configuration': 'modality_configuration',
            '/auth/signin': 'signin',
            '/auth/signup': 'join',
            '/ccss/': 'ccss',
            '/ngss/': 'ngss',
            '/standard/': 'standard'
            }

###############################
# Page Types used for tracking
# in GA/ADS. For more complex
# URLs, c.pageType can be overiden
# in the controller methods.
# see base controller for details.
# key = URL path
# value = Page Type
###############################
page_types = {'/my/groups/': 'Groups',
            '/group': 'Group Details',
            '/group-members': 'Group Members',
            '/group-resources': 'Group Resources',
            '/group-settings': 'Group Settings',
            '/my/dashboard/': 'Dashboard',
            '/my/bookmarks/': 'Bookmarks',
            '/my/content/': 'My Contents',
            '/my/tests/': 'My Tests',
            '/search/': 'Search',
            '^/$': 'Home',
            '/student/': 'Student Home',
            '/teacher/': 'Teacher Home',
            '/ccss/': 'ccss',
            '/ngss/': 'ngss',
            '/standard/': 'standard'
            }

###############################
# Marketing snippets url
# This URL hosts the marketing HTML snippets that are used in
# the landing page.
###############################
#marketing_url = http://marketing.ck12.org.s3.amazonaws.com/dev/
marketing_url = https://localhost/marketing/

###############################
# interactives (Simulations/PLIX) URL
##############################
interactives_url = https://simtest.ck12.org

###############################
# Optimizely settings
# seperate multiple regex with semicolon
##############################
optimizely_enabled=0
optimizely_js=//cdn.optimizely.com/js/179974825.js
#optimizely_js=//cdn.amp.ai/ck12/sync-includes/staging.js
optimizely_include_regex=.*
optimizely_exclude_regex=

######################################
# Google Places API
######################################
google_places_api_key = AIzaSyDT20vbFED5X2uGHcCRAHm8rwNP-GREGFI



##############################################
# FlexBook Details implementation switcher
##############################################

#fbs_details_mode (classic or react)
#fbs_details_mode_override (none, cookie, query)

fbs_details_mode = classic 
fbs_details_mode_override = cookie



######################################
# FlexBook deep links (Abbr. : fbdl)
######################################
fbdl_enabled=true
fbdl_domain=https://ckfb.test-app.link
fbdl_prefix=%(fbdl_domain)s/read/?$deeplink_path=


###############################
# Logging configuration
###############################

[loggers]
keys = root, routes, flxweb, slowapi, saveerrors

[handlers]
keys = flxweb,slowapi, saveerrors, saveerrors_email

[formatters]
keys = generic,slowapi, saveerrors

[logger_root]
level = INFO
handlers = flxweb

[logger_routes]
level = INFO
handlers =
qualname = routes.middleware
# "level = DEBUG" logs the route matched and routing variables.

[logger_flxweb]
level = DEBUG
handlers =
qualname = flxweb

[logger_slowapi]
level = INFO
handlers = slowapi
qualname = slowapi
propagate = 0

[logger_saveerrors]
level = INFO
handlers = saveerrors, saveerrors_email
qualname = saveerrors
propagate = 0

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[handler_flxweb]
class = flxweb.lib.safeloghandler.TimedRotatingFileHandlerSafe
args = ('/opt/2.0/log/flxweb.log', 'h', 12, 8, 'utf-8')
level = NOTSET
formatter = generic

[handler_slowapi]
class = flxweb.lib.safeloghandler.TimedRotatingFileHandlerSafe
args = ('/opt/2.0/log/slowapi.log', 'h', 24, 14, 'utf-8')
level = NOTSET
formatter = slowapi

[handler_saveerrors]
class = flxweb.lib.safeloghandler.TimedRotatingFileHandlerSafe
args = ('/opt/2.0/log/saveerrors.log', 'h', 24, 14, 'utf-8')
level = NOTSET
formatter = slowapi

[handler_saveerrors_email]
class = logging.handlers.SMTPHandler
args = ( "%(smtp_server)s" , "%(error_email_from)s" , "dev-errors@ck12.org" , "[FLXWEB Artifact Save Error on gandalf.ck12.org]" )
level = NOTSET
formatter = saveerrors

[formatter_generic]
format = %(asctime)s,%(msecs)03d %(levelname)-5.5s %(threadName)s [%(name)s] %(message)s
datefmt = %Y-%m-%d %H:%M:%S

[formatter_slowapi]
format = %(asctime)s,%(msecs)03d %(message)s
datefmt = %Y-%m-%d %H:%M:%S

[formatter_saveerrors]
format = %(asctime)s,%(msecs)03d %(message)s
datefmt = %Y-%m-%d %H:%M:%S
