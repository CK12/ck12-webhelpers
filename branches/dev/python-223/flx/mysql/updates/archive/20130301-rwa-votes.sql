DROP VIEW IF EXISTS `RwaVotes`;
CREATE VIEW `RwaVotes` AS ( select a.id, a.updatetime, a.creatorID, 0 as votes from Artifacts as a, ArtifactHasBrowseTerms as ab, BrowseTerms as b where a.artifactTypeID = 13 and a.id = ab.artifactID and ab.browseTermID = b.id and b.termTypeID = 11 and a.id not in ( select distinct artifactID from ArtifactFeedbacks where type = 'relevance' or type = 'creativity' or type = 'clarity' or type = 'impactful' ) ) union ( select a.id, a.updatetime, a.creatorID, count(*) as votes from Artifacts as a join ArtifactHasBrowseTerms as ab on a.id = ab.artifactID join BrowseTerms as b on ab.browseTermID = b.id and b.termTypeID = 11 left outer join ArtifactFeedbacks as af on a.id = af.artifactID where a.artifactTypeID = 13 and af.type = 'relevance' or type = 'creativity' or type = 'clarity' or type = 'impactful' group by af.artifactID ) order by votes;
