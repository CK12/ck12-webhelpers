(function(){tinymce.PluginManager.requireLangPack("ck12embed");var b="";var e="id|name|title|longdesc|class|width|height|src|frameborder";var f="itemprop|itemscope|itemtype";var a="description|image|name|url";var c="ck12-media-placeholder";var d="/images/trans.gif";tinymce.create("tinymce.plugins.CK12EmbedPlugin",{init:function(h,i){var g=this;this.editor=h;if(h.settings.ck12_plugins_url){i=h.settings.ck12_plugins_url+"ck12embed"}b=g.plugin_url=i;h.onPreInit.add(function(){var k=null;var j=null;h.parser.addNodeFilter("iframe",function(l){var m=l.length;while(m--){j=l[m];k=g.embedNodeToImg(j);j.parent.replace(k)}});h.serializer.addNodeFilter("img",function(l,n,m){var o=l.length,p;while(o--){p=l[o];var q=p.attr("class")||"";if(q.indexOf("ck12-media-placeholder")!==-1){g.imgToEmbed(p,m)}}})});h.addCommand("mceEmbedDialog",function(){h.windowManager.open({file:b+"/embed.htm",width:420,height:500,inline:1},{plugin_url:b})});h.addCommand("mceEmbedDelete",function(){var j=h.selection.getNode();if(j&&j.className&&j.className.indexOf(c)!=-1){j.parentNode.removeChild(j)}});h.addButton("ck12embed",{title:"ck12embed.desc",cmd:"mceEmbedDialog","class":"mce_media"});h.onNodeChange.add(function(k,j,l){if(l.nodeName=="IMG"){if(l.className&&l.className.indexOf(c)!=-1){j.setActive("ck12embed",true);j.setDisabled("image",true)}else{j.setActive("ck12embed",false);j.setDisabled("image",false)}}else{j.setActive("ck12embed",false);j.setDisabled("image",false)}});h.onInit.add(function(){if(h&&h.plugins.contextmenu){h.plugins.contextmenu.onContextMenu.add(function(l,j,o){var q,n=h.selection,k=n.getNode()||h.getBody();var p=h.dom.getParent(o,"div");if(k.nodeName=="IMG"&&h.dom.getAttrib(o,"class").indexOf(c)!=-1){j.removeAll();j.add({title:"Edit Embedded Object",icon:"media",cmd:"mceEmbedDialog",ui:true});j.add({title:"Delete Embedded Object",icon:"ck12EmbedDelete",cmd:"mceEmbedDelete",ui:true});j.addSeparator()}})}})},createControl:function(h,g){return null},_in_array:function(g,k){var h,j;for(h=0;h<g.length;h++){j=g[h];if(j==k){return true}}return false},embedNodeToJSON:function(k){var s=this;if(k){var o=f.split("|");var l=e.split("|");var r=a.split("|");var p={};var m,q;m=k.attributes.length;while(m--){q=k.attributes[m];if(s._in_array(l,q.name)){p["data-ck12embed-iframe-"+q.name]=q.value}}var h=k.parent;if(h){if(h.name=="div"){m=h.attributes.length;while(m--){q=h.attributes[m];if(s._in_array(o,q.name)){p["data-ck12embed-container-"+q.name]=q.value}}}var n=h.getAll("meta");if(n&&n.length){m=n.length;while(m--){q=n[m];var g=q.attr("itemprop");var j=q.attr("content");if(s._in_array(r,g)){p["data-ck12embed-meta-"+g]=j}}}}return p}},embedNodeToImg:function(i){var h=this;if(i){var j=h.embedNodeToJSON(i);var g=tinymce.html.Node.create("img",j);g.attr("src",b+d);g.attr("class",c);if(j["data-ck12embed-iframe-width"]){g.attr("width",j["data-ck12embed-iframe-width"])}if(j["data-ck12embed-iframe-height"]){g.attr("height",j["data-ck12embed-iframe-height"])}return g}},htmlstrToImg:function(i){var j=null;var g=null;var h=null;if(i){j=this.editor.parser.parse(i);if(j){h=j.getAll("img")[0]}}return h},imgToEmbed:function(h,n){if(h){var l={container:{},iframe:{},meta:{}};var j,m,o;m=h.attributes.length;while(m--){j=h.attributes[m];o=j.name.replace("data-ck12embed-","").split("-");if(l[o[0]]){l[o[0]][o[1]]=j.value}}var g=tinymce.html.Node.create("div",l.container);if(!g.attr("itemscope")){g.attr("itemscope","")}if(l.meta){var p=null;for(o in l.meta){if(l.meta.hasOwnProperty(o)){j=l.meta[o];p=this.editor.parser.parse("<meta />").getAll("meta")[0];p.attr("itemprop",o);p.attr("content",j);g.append(p)}}}if(l.iframe&&!("frameborder" in l.iframe)){l.iframe.frameborder="0"}var k=tinymce.html.Node.create("iframe",l.iframe);g.append(k);h.replace(g)}},getInfo:function(){return{longname:"CK-12 Embedded Objects",author:"Nachiket Karve",authorurl:"http://www.ck12.org",infourl:"https://insight.ck12.org/wiki/index.php/Tinymce-flxweb",version:"1.0"}}});tinymce.PluginManager.add("ck12embed",tinymce.plugins.CK12EmbedPlugin)})();