WSGIPythonPath /opt/2.0/flx/pylons/flx:/opt/env/flx/lib/python2.7/site-packages
WSGIPythonPath /opt/2.0/flx/pylons/auth:/opt/env/auth/lib/python2.7/site-packages
WSGIPythonPath /opt/2.0/taxonomy/pylons/sts:/opt/env/taxonomy/lib/python2.7/site-packages
WSGIPythonPath /opt/2.0/assessment/engine/pyramid:/opt/env/asmt/lib/python2.7/site-packages
WSGIPythonPath /opt/2.0/peerhelp/core/pyramid:/opt/env/peerhelp/lib/python2.7/site-packages
WSGIPythonPath /opt/2.0/adminapp/pylons/flxadmin/:/opt/env/flxadmin/lib/python2.7/site-packages
WSGIPythonPath /opt/2.0/flxweb:/opt/env/flxweb/lib/python2.7/site-packages
WSGIApplicationGroup %{GLOBAL}
<VirtualHost *:80>
    <Directory /var/www/>
        Options -Indexes
    </Directory>

    Options -Indexes
    AllowEncodedSlashes On
    ServerAdmin webmaster@ck12.org
    
    # Possible values include: debug, info, notice, warn, error, crit,
    # alert, emerg.
    LogLevel warn
    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined

    ## Log special headers
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\" APP ID: \"%{x-ck12-meta-appid}i\" **%T/%D**" api_access
    CustomLog /var/log/apache2/api_access.log api_access

    ## Log special headers
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" response-time:%T.%D secs" response_time
    CustomLog /var/log/apache2/response_time.log response_time

    # Enable keep-alive
    KeepAlive On
    KeepAliveTimeout 25
    MaxKeepAliveRequests 500

    ExpiresActive On

    #####################################################
    # CONFIGURE media caching
    Header unset ETag
    FileETag None
    <LocationMatch "(?i)^.*\.(ico|flv|jpg|jpeg|png|gif|js|css|woff|ttf|eot|svg)$">
        Header set Cache-Control "public, max-age=31536000"
        Header set Accept-Ranges none
        RequestHeader unset Range
    </LocationMatch>
    <FilesMatch "\.(eot|otf|woff|ttf)$">
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
    ##
    ######################################################

    ##### Setting CORS #####
    <FilesMatch "(?<!\.eot|\.otf|\.woff|\.ttf)$">
        SetEnvIf Origin "^http(s)?://(.+\.)?(ck12\.org)$" origin_is=$0
        Header set Access-Control-Allow-Origin %{origin_is}e env=origin_is
        Header set Access-Control-Allow-Headers "Content-Type, *"
        Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header set Access-Control-Allow-Credentials "true"
    </FilesMatch>
    #########################

    ####### IE P3P header #####
    <IfModule mod_headers.c>
        Header set P3P "CP=\"ALL DSP COR CURa OUR IND ONL COM NAV INT CNT STA PRE\""
    </IfModule>


    ##### Mod DeFlate #####
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json

    AddType application/vnd.ms-fontobject .eot
    AddType font/ttf .ttf
    AddType font/otf .otf
    AddType application/x-font-woff .woff

    DeflateCompressionLevel 9
    DeflateMemLevel 9
    DeflateWindowSize 15

    # Netscape 4.x has some problems...
    BrowserMatch ^Mozilla/4 gzip-only-text/html

    # Netscape 4.06-4.08 have some more problems
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
    # IE5.x and IE6 get no gzip, but allow 7+
    BrowserMatch \bMSIE\s7 !no-gzip

    # NOTE: Due to a bug in mod_setenvif up to Apache 2.0.48
    # the above regex won't work. You can use the following
    # workaround to get the desired effect:
    BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html

    # Don't compress pre-compress data
    SetEnvIfNoCase Request_URI \.pdf$ no-gzip dont-vary

    # Make sure proxies don't deliver the wrong content
    Header append Vary User-Agent env=!dont-vary

    ##### Mod DeFlate #####

    # Mod MemCache For Apache2
    <IfModule mod_mem_cache.c>
            CacheEnable mem /
            MCacheSize 262144
            MCacheMaxObjectCount 10000
            MCacheMinObjectSize 1
            MCacheMaxObjectSize 5096
    </IfModule>

    LogLevel warn
    WSGIDaemonProcess R2 processes=5 threads=25 maximum-requests=10000 home=/opt/ python-path=/opt/env/flxweb/lib/python2.7/site-packages display-name=%{GROUP}
    WSGIDaemonProcess flx2_wsgi processes=5 threads=25 maximum-requests=10000 home=/opt/ python-path=/opt/env/flx/lib/python2.7/site-packages display-name=%{GROUP}
    WSGIDaemonProcess flxadmin_wsgi processes=5 threads=25 maximum-requests=10000 home=/opt/ python-path=/opt/env/flxadmin/lib/python2.7/site-packages display-name=%{GROUP}
    WSGIDaemonProcess taxonomy_wsgi processes=5 threads=25 maximum-requests=10000 home=/opt/ python-path=/opt/env/taxonomy/lib/python2.7/site-packages display-name=%{GROUP}
    WSGIDaemonProcess auth_wsgi processes=5 threads=25 maximum-requests=10000 home=/opt/ python-path=/opt/env/auth/lib/python2.7/site-packages display-name=%{GROUP}
    #WSGIDaemonProcess dexter_wsgi processes=5 threads=25 maximum-requests=10000 home=/opt/ python-path=/opt/env/dexter/lib/python2.7/site-packages display-name=%{GROUP}
    WSGIDaemonProcess assessment_wsgi processes=5 threads=25 maximum-requests=10000 home=/opt/ python-path=/opt/env/asmt/lib/python2.7/site-packages display-name=%{GROUP}
    WSGIDaemonProcess peerhelp_wsgi processes=5 threads=25 maximum-requests=10000 home=/opt/ python-path=/opt/env/peerhelp/lib/python2.7/site-packages display-name=%{GROUP}
    WSGIProcessGroup R2

    RewriteEngine on
    RewriteCond %{HTTPS} off
    RewriteRule (.*) https://%{HTTP_HOST}:443%{REQUEST_URI}

    Alias /media /opt/2.0/flxweb/flxweb/public/media/
    Include /etc/apache2/apps/*

</VirtualHost>

<VirtualHost *:443>
    <Directory /var/www/>
        Options -Indexes
    </Directory>

    Options -Indexes
    AllowEncodedSlashes On
    ServerAdmin webmaster@ck12.org
    
    # Possible values include: debug, info, notice, warn, error, crit,
    # alert, emerg.
    LogLevel warn
    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined

    ## Log special headers
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\" APP ID: \"%{x-ck12-meta-appid}i\" **%T/%D**" api_access
    CustomLog /var/log/apache2/api_access.log api_access

    ## Log special headers
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" response-time:%T.%D secs" response_time
    CustomLog /var/log/apache2/response_time.log response_time

    # Enable keep-alive
    KeepAlive On
    KeepAliveTimeout 25
    MaxKeepAliveRequests 500

    ExpiresActive On

    #####################################################
    # CONFIGURE media caching
    Header unset ETag
    FileETag None
    <LocationMatch "(?i)^.*\.(ico|flv|jpg|jpeg|png|gif|js|css|woff|ttf|eot|svg)$">
        Header unset Last-Modified
        Header set Cache-Control "public, max-age=31536000"
        Header set Accept-Ranges none
        RequestHeader unset Range
    </LocationMatch>
    <FilesMatch "\.(eot|otf|woff|ttf)$">
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
    ##
    ##### Setting CORS #####
    <FilesMatch "(?<!\.eot|\.otf|\.woff|\.ttf)$">
        SetEnvIf Origin "^http(s)?://(.+\.)?(ck12\.org)$" origin_is=$0
        Header set Access-Control-Allow-Origin %{origin_is}e env=origin_is
        Header set Access-Control-Allow-Headers "Content-Type, *"
        Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header set Access-Control-Allow-Credentials "true"
    </FilesMatch>
    #########################

    ####### IE P3P header #####
    <IfModule mod_headers.c>
        Header set P3P "CP=\"ALL DSP COR CURa OUR IND ONL COM NAV INT CNT STA PRE\""
    </IfModule>

    ##### Mod DeFlate #####
    # Insert filter
    SetOutputFilter DEFLATE
    DeflateBufferSize 8096
    DeflateCompressionLevel 9
    DeflateMemLevel 9
    DeflateWindowSize 15


    # Netscape 4.x has some problems...
    BrowserMatch ^Mozilla/4 gzip-only-text/html

    # Netscape 4.06-4.08 have some more problems
    BrowserMatch ^Mozilla/4\.0[678] no-gzip

    # MSIE masquerades as Netscape, but it is fine
    # BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

    # NOTE: Due to a bug in mod_setenvif up to Apache 2.0.48
    # the above regex won't work. You can use the following
    # workaround to get the desired effect:
    BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html

    # Don't compress pre-compress data
    SetOutputFilter DEFLATE
    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ \
    no-gzip dont-vary
    SetEnvIfNoCase Request_URI \
    \.(?:exe|t?gz|zip|bz2|sit|rar)$ \
    no-gzip dont-vary
    SetEnvIfNoCase Request_URI \.pdf$ no-gzip dont-vary

    # Make sure proxies don't deliver the wrong content
    Header append Vary User-Agent env=!dont-vary

    ##### Mod DeFlate #####

    # Mod MemCache For Apache2
    <IfModule mod_mem_cache.c>
            CacheEnable mem /
            MCacheSize 262144
            MCacheMaxObjectCount 10000
            MCacheMinObjectSize 1
            MCacheMaxObjectSize 5096
    </IfModule>

    LogLevel warn
    #WSGIDaemonProcess R2 processes=5 threads=15 home=/opt/ display-name=%{GROUP}
    #WSGIProcessGroup R2

    #   SSL Engine Switch:
    #   Enable/Disable SSL for this virtual host.
    SSLEngine on

	#   A self-signed (snakeoil) certificate can be created by installing
	#   the ssl-cert package. See
	#   /usr/share/doc/apache2.2-common/README.Debian.gz for more info.
	#   If both key and certificate are stored in the same file, only the
	#   SSLCertificateFile directive is needed.
    SSLCertificateFile      /etc/apache2/ssl/ck12.org.crt
    SSLCertificateKeyFile   /etc/apache2/ssl/ck12.key
    SSLCertificateChainFile /etc/apache2/ssl/gd_bundle.crt
    SSLOptions +FakeBasicAuth +ExportCertData +StrictRequire

    RewriteEngine on

    Include /etc/apache2/apps/*

</VirtualHost>


#For Hyperic Monitoring
ExtendedStatus On
<Location /server-status>
    SetHandler server-status
    #Order deny,allow
    #Deny from all
    Require all granted
    Allow from localhost
</Location>
